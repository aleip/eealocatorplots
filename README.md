# EU-GIRP (EU-Greenhouse gas Inventory Reporting Plots; eealocatorplots)
## R program to generate plots from EEA-locator CRF data

This program has been conceptualized and programmed by Adrian Leip
European Commission, Joint Research Centre (JRC), Institute for Environment and Sustainability, Ispra (VA), Italy
adrian.leip@jrc.ec.europa.eu
to support the EU GHG inventory system.

Start of project: October 2014
First version available (EU-GIRP.v1: January 2015)
Public repository on https://github.com/aleip/eealocatorplots.git


This folder contains the source code that are used to generate EEA plots for the EU GHG inventory (from 2015 onwards).

### The following software is required to run the code:
- R statistical software, see 
- bash scripting environment

### The following files are required to start the process:
- *EEA_GHG_MMR_locator_20150318.cub_2015.csv*: This is an *example* for a text-comma-separated file with the data that are needed for plotting. It is generated by a bash-script (eealocator_csv.bash) which extracts relevant data from a EEA-locator output (e.g. eealocator.csv) into a working file. The name of the working file contains EEA-locator meta-information: Selected submission year (previously also: EF used, Notation key, Methods) (here year 2015 submission is selected and all EFs, Notation keys, methods). This file has been generated on the basis of the following files:
  * *meta_data_dimensions.csv*: This file lists all the data from the total EEA_locator output. It provides for each item (category, unit, gas, measure) which is intended to be used in the plots both the full name as it appears in the EEA-locator (thus in the xml) and a corresponding short acronym.  
  * *eealocator_csv.bash*: bash script extracting the data into the working file (see above). The script writes also to other files which are required for the plotting script: lists.txt and meta_data_dimensions.txt (see below). lists.txt contains all categories, measures, units, and parties that are included in the working file (in R format). 
  * *EEA_GHG_MMR_locator_20150318.cub.csv* (dummy name actual eea-locator output): CSV file generated as follows: 
    * *Load EEA locator* cube in excel pivot table (new cube: Got to Insert – Pivot Table – Use external data source – Choose connection - OK)
	* *Report Filter*: Submission Year, *Column Label*: Inventory Year, *Row Labels*: Variable name, Party code, Notation key. *Values*: Value
	* Settings Column Label: Subtotals: None; Show Item in Tabular Format; Repeat Item Label
	* *Export table to csv* eealocatortest.csv
- *eealocatorplots.r*: main program to for the plots: EUIRplot-tool
- *attributes.txt*: contains the information on the colours and patterns to be used for the barplots. can be edited to change layout of of the plots
- *curplot.csv*: file that requests the plots to be generated. The information this file must contains is: category-source-gas combinations for which plots are to be generated. Parameter to be plotted (e.g. Activity data, emissions, ...) and type(s) of plot (see below). Please see the header of the file with further information on the format of the file.
- *lists.txt*: automatically generated by *eealocator_csv.bash*. Contains available categories, sources, gases, units, and parties in the EEA-locator file
- *meta_data_dimensions.txt*: automatically generated by *eealocator_csv.bash*. Contains the info from *meta_data_dimensions.csv*, processed as input for *eealocatorplots.r*

### Principles of the EUIRplot-tool
There are various types of plots that are possible, which are available for two types of data.
For each source category (e.g. animal type in category 'Enteric Fermentation') the following data are required: activity data (e.g. Population), emissions (by gas) and implied emission factor (by gas). They need to be indicated with the acronyms 'AD', 'EM', and 'IEF'. For other parameters (any acronym) they need to be linked to any AD (plot request in appropriate line of curplot.csv.
The EUIRplot-tool distinguishes the following two types of data:
- **Summable data (*ADEM*)**: Activity data, emissions etc. This are data for which it 'makes sense' to add the values of different countries and to calculate a 'contribution' from different countries. The available plots for summable data are:
  1. **'value'**: In an **ADEM-value** plot, the sum of the values V{t} of all countries (EU18+IS) are plotted in a barplot against the years. Thus also the 'value' plot shows the trend in absolute terms. It is done$ for all Activity data and emissions. The 10 countries (number can be modified) contributing (on average over the whole period) most to the EU28+IS sum are shown in a pre-defined pattern and their share is given next to the legend indicating also the name of the countries. All other countries are lumped to the category 'Other'.
  2. **'trend'**: In an **ADEM-trend** plot, for each year t the sum of change (in absolute values) of a parameter (V{t} - V{t-1}) is plotted. It is done$ for all Activity data and emissions. For emissions, the trend is determined both by changes in AD and IEF - thus the plot shows the 10 countries (number can be modified) contributing most to the average annual change over the whole period in a pre-defined pattern. Next to the legend the contribution to the average annual change is given, as well as the contribution to the average change in the country do to the trend in AD or IEF (not yet implemented).
- **Averageable data (*IEF*)**: Implied emissions factors, other parameters and factors. This are data for which a sum does not make sense, but the EU28+IS value must be calculated as (weighted) average. 
  1. **'value'**: In an **IEF-value** plot, the EU28+IS average (AD-weighted average) of the value (IEF or other factor) is plotted together with some statistical measures of the distribution across countries (boxplot): median (geometric mean), and lower and upper quartiles. Furthermore, the countries with the highest relative deviation from the EU28+IS average are plotted. In the legend, the mean, min and max value of the parameter is indicated. In practice, for each data point its relation to the EU28+IS average of the year is calculated and countries with the highest absolute difference to 1 are selected for the plot to ensure that all most important outliers are included.
  2. **'trend'**: In an **IEF-trend** plot, the EU28+IS average (arithmetic mean) of the inter-annual change of the value (IEF or other factor) is plotted together with some statistical measures of the distribution across countries (boxplot): median (geometric mean), and lower and upper quartiles. Selection of countries and content of legend is in analogy to the IEF-value plot. It may happen in particular for a IEF-trend plot (but in theory also for an IEF-value plot) that not all 'outliers' for a single year are covered by the 10 countries with the highest outliers; these points are then marked with another symbol not indicating which country it relates to, however these are usually relatively small inter-annual changes.
  3. **'countries'**: In an **IEF-countries** plot, for each country the range of values (IEF or other parameter) over the whole time period is plotted (min-max and median). Needs still improvement: addition of average, improved design, ... 





$ Note: the implementation of the program is so far only for the agriculture sector!